<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <title>ZOMBIЕGLOBAL</title>
  <style>
    :root{
      --bg:#070A0F; --glass:rgba(10,14,20,.62); --b:rgba(255,255,255,.12);
      --t:#EAF7F1; --m:rgba(234,247,241,.65);
      --g:#45FF75; --c:#2FA9FF; --r:#FF3D4D;
      --rad:18px; --sh:0 24px 90px rgba(0,0,0,.65);
    }
    *{box-sizing:border-box} html,body{height:100%;margin:0;background:var(--bg);color:var(--t);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    #root{position:fixed;inset:0;overflow:hidden}
    .safe{padding:max(14px,env(safe-area-inset-top)) max(14px,env(safe-area-inset-right)) max(14px,env(safe-area-inset-bottom)) max(14px,env(safe-area-inset-left))}
    .bg{position:absolute;inset:0;background:radial-gradient(120% 80% at 50% 0%, rgba(47,169,255,.10), rgba(0,0,0,.92))}
    .bg video{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:.18;filter:saturate(1.1) contrast(1.05)}
    .grain{position:absolute;inset:-20px;pointer-events:none;opacity:.06;mix-blend-mode:overlay;
      background-image:radial-gradient(rgba(255,255,255,.06) 1px, rgba(0,0,0,0) 1px);
      background-size:3px 3px;
    }

    .screen{position:absolute;inset:0;display:none}
    .screen.on{display:block}

    .glass{background:var(--glass);border:1px solid var(--b);border-radius:var(--rad);backdrop-filter:blur(14px);box-shadow:var(--sh)}
    .btn{all:unset;cursor:pointer;user-select:none;text-align:center;
      padding:14px 16px;border-radius:16px;border:1px solid var(--b);
      background:rgba(255,255,255,.06);letter-spacing:.12em;text-transform:uppercase;font-weight:900;font-size:12px
    }
    .btn.primary{background:rgba(69,255,117,.14);border-color:rgba(69,255,117,.25)}
    .btn.blue{background:rgba(47,169,255,.12);border-color:rgba(47,169,255,.22)}
    .btn.red{background:rgba(255,61,77,.12);border-color:rgba(255,61,77,.22)}
    .muted{color:var(--m);line-height:1.5}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}

    /* INTRO: centered YouTube-style player */
    .introWrap{height:100%;display:grid;place-items:center}
    .introCard{width:min(980px,94vw);padding:14px}
    .introTop{display:flex;justify-content:space-between;gap:10px;align-items:flex-start}
    .brand{letter-spacing:.22em;text-transform:uppercase;font-weight:950;font-size:14px}
    .tag{margin-top:6px;color:var(--m);font-size:12px;letter-spacing:.08em}
    .player{margin-top:12px;border-radius:16px;overflow:hidden;border:1px solid var(--b);background:#000;aspect-ratio:16/9}
    .player video{width:100%;height:100%;object-fit:contain}
    .introActions{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
    .hint{margin-top:10px;font-size:12px;color:rgba(234,247,241,.55)}

    /* TIKTOK-ish MAIN */
    .main{height:100%;display:grid;grid-template-rows:auto 1fr auto;gap:12px}
    .topbar{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .topbar .left{display:flex;flex-direction:column;gap:4px}
    .topbar .title{letter-spacing:.22em;text-transform:uppercase;font-weight:950;font-size:14px}
    .topbar .sub{color:var(--m);font-size:12px;letter-spacing:.08em}

    .stage{position:relative;display:grid;grid-template-columns:1fr auto;gap:12px;min-height:0}
    .feed{position:relative;min-height:0}
    .card{padding:14px;display:flex;flex-direction:column;gap:10px}
    .big{font-size:28px;font-weight:950;letter-spacing:.06em}
    .pill{display:inline-flex;gap:8px;align-items:center;padding:10px 12px;border-radius:999px;border:1px solid var(--b);background:rgba(0,0,0,.28)}
    .dot{width:8px;height:8px;border-radius:50%}
    .dot.g{background:rgba(69,255,117,.9)} .dot.c{background:rgba(47,169,255,.9)} .dot.r{background:rgba(255,61,77,.9)}

    .rightbar{display:flex;flex-direction:column;gap:10px;align-items:center;justify-content:flex-end}
    .act{all:unset;cursor:pointer;width:54px;height:54px;border-radius:18px;border:1px solid var(--b);
      background:rgba(0,0,0,.30);backdrop-filter:blur(14px);display:grid;place-items:center
    }
    .act span{font-size:11px;color:rgba(234,247,241,.75);letter-spacing:.12em;text-transform:uppercase;font-weight:900}
    .nav{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
    .nav .btn{padding:16px 12px}

    @media (max-width:560px){
      .introActions{grid-template-columns:1fr}
      .stage{grid-template-columns:1fr}
      .rightbar{flex-direction:row;justify-content:space-between}
    }
  </style>
</head>
<body>
<div id="root">
  <div class="bg">
    <video id="bgv" playsinline autoplay muted loop></video>
  </div>
  <div class="grain"></div>

  <!-- INTRO -->
  <section id="intro" class="screen on safe">
    <div class="introWrap">
      <div class="introCard glass">
        <div class="introTop">
          <div>
            <div class="brand">ZOMBIEGLOBAL</div>
            <div class="tag">вирус = ссылка • цепочка заражений • сезонный топ</div>
          </div>
          <button class="btn blue" id="skip">SKIP</button>
        </div>

        <div class="player">
          <video id="introV" playsinline preload="auto"></video>
        </div>

        <div class="introActions">
          <button class="btn primary" id="startSound">START (SOUND)</button>
          <button class="btn" id="startMute">START (MUTED)</button>
        </div>

        <div class="hint">iPhone: звук включается только после нажатия кнопки — это правило Safari.</div>
      </div>
    </div>
  </section>

  <!-- MAIN -->
  <section id="main" class="screen safe">
    <div class="main">
      <header class="topbar">
        <div class="left">
          <div class="title">ZOMBIEGLOBAL</div>
          <div class="sub">сезон <span id="season" class="mono">—</span> • spreads <span id="spreads" class="mono">0</span></div>
        </div>
        <button class="btn red" id="reset">RESET</button>
      </header>

      <div class="stage">
        <div class="feed">
          <div class="glass card">
            <div class="pill"><span class="dot g"></span><span class="mono" id="id">#------</span><span class="muted">твоя метка</span></div>
            <div class="big mono" id="link">—</div>
            <div class="muted">Зашёл по ссылке → ты заражён “от #<span class="mono" id="by">------</span>”. Разнеси дальше и стань источником.</div>

            <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
              <button class="btn primary" id="copy">COPY LINK</button>
              <button class="btn blue" id="share">SHARE</button>
            </div>

            <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
              <button class="btn" id="tgCh">TG CHANNEL</button>
              <button class="btn" id="tgBot">TG BOT</button>
            </div>

            <div class="muted" style="font-size:12px">
              Дальше сюда добавим: карта мира, топ месяца, турниры, твой “след” в истории.
              Сейчас — **правильный TikTok-интерфейс** + вирус-ссылка.
            </div>
          </div>
        </div>

        <aside class="rightbar">
          <button class="act" id="actTop" title="Top">
            <span>TOP</span>
          </button>
          <button class="act" id="actMap" title="World">
            <span>MAP</span>
          </button>
          <button class="act" id="actPlay" title="Play">
            <span>PLAY</span>
          </button>
        </aside>
      </div>

      <nav class="nav">
        <button class="btn primary" id="goPlay">PLAY NOW</button>
        <button class="btn" id="goTop">MONTH TOP</button>
        <button class="btn" id="goMap">WORLD MAP</button>
      </nav>
    </div>
  </section>
</div>

<script>
  // ---- CONFIG ----
  const INTRO_SRC = "assets/intro.mp4";
  const BG_SRC    = "assets/bg.mp4"; // optional (можно не класть файл)
  const TG_CH     = "https://t.me/zombievirus_server";
  const TG_BOT    = "https://t.me/ZombieVirusLabBot";

  // ---- HELPERS ----
  const $ = s => document.querySelector(s);
  const LS = { id:"zg_id", by:"zg_by", spreads:"zg_spreads" };
  const pad = n => String(n).padStart(6,"0");
  const base = () => location.href.split("#")[0].split("?")[0];
  const getQ = k => new URL(location.href).searchParams.get(k);
  const link = id => `${base()}?ref=${id}`;

  function getId(){
    let id = localStorage.getItem(LS.id);
    if(!id){ id = pad((Math.random()*900000+100000)|0); localStorage.setItem(LS.id,id); }
    return id;
  }
  function initRef(){
    const ref = getQ("ref");
    if(ref && /^\d{6}$/.test(ref)){
      const me = getId();
      if(ref !== me) localStorage.setItem(LS.by, ref);
    }
  }
  function spreads(add=0){
    const v = (parseInt(localStorage.getItem(LS.spreads)||"0",10) + add);
    localStorage.setItem(LS.spreads, String(v));
    return v;
  }
  async function copy(text){
    try{ await navigator.clipboard.writeText(text); return true; }
    catch(e){ prompt("Copy:", text); return false; }
  }

  function render(){
    const id = getId();
    $("#id").textContent = "#" + id;
    $("#by").textContent = localStorage.getItem(LS.by) || "------";
    $("#link").textContent = link(id);
    $("#spreads").textContent = spreads(0);
    $("#season").textContent = "#" + (new Date().getMonth()+1);
  }

  function show(which){
    $("#intro").classList.toggle("on", which==="intro");
    $("#main").classList.toggle("on", which==="main");
  }

  // ---- INTRO SETUP ----
  const introV = $("#introV");
  introV.src = INTRO_SRC;
  introV.muted = true;
  introV.loop = true;
  introV.play().catch(()=>{});

  const bgv = $("#bgv");
  bgv.src = BG_SRC;
  bgv.play().catch(()=>{}); // если файла нет — просто будет пусто, не ломает

  function enterMain(){
    introV.pause();
    show("main");
    render();
  }

  $("#startSound").onclick = async ()=>{
    try{ introV.muted = false; await introV.play(); }catch(e){}
    enterMain();
  };
  $("#startMute").onclick = ()=>{ introV.muted = true; enterMain(); };
  $("#skip").onclick = ()=> enterMain();

  // ---- MAIN ACTIONS ----
  $("#copy").onclick = async ()=>{
    const ok = await copy(link(getId()));
    if(ok){ spreads(1); render(); }
  };
  $("#share").onclick = async ()=>{
    const url = link(getId());
    spreads(1); render();
    if(navigator.share){
      try{ await navigator.share({ title:"ZOMBIEGLOBAL", text:"Beat me. Enter via my link.", url }); }catch(e){}
    }else{
      await copy(url);
    }
  };

  $("#tgCh").onclick = ()=> open(TG_CH, "_blank");
  $("#tgBot").onclick = ()=> open(TG_BOT, "_blank");

  $("#reset").onclick = ()=>{
    if(confirm("Reset local progress?")){
      localStorage.removeItem(LS.id);
      localStorage.removeItem(LS.by);
      localStorage.removeItem(LS.spreads);
      location.href = base();
    }
  };

  // placeholders (пока без портянок и без игры — только UI)
  const soon = (t)=>alert(t + " — подключим на следующем шаге (без мусорного кода).");
  $("#actTop").onclick = ()=> soon("MONTH TOP");
  $("#actMap").onclick = ()=> soon("WORLD MAP");
  $("#actPlay").onclick = ()=> soon("PLAY MODE");
  $("#goTop").onclick  = ()=> soon("MONTH TOP");
  $("#goMap").onclick  = ()=> soon("WORLD MAP");
  $("#goPlay").onclick = ()=> soon("PLAY MODE");

  // init
  initRef();
</script>
</body>
</html>
