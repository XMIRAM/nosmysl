<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#090b10" />
  <title>ZOMBIE LINK ‚Äî –º–µ–º-–≤–∏—Ä—É—Å</title>
  <meta property="og:title" content="ZOMBIE LINK" />
  <meta property="og:description" content="–¢—ã –∑–∞—Ä–∞–∂—ë–Ω. –°–æ–∑–¥–∞–π —Å—Å—ã–ª–∫—É —É–∫—É—Å–∞. –ü–µ—Ä–µ–¥–∞–π –¥–∞–ª—å—à–µ." />
  <style>
    :root{
      --bg:#090b10;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.035);
      --stroke: rgba(255,255,255,.11);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);
      --muted2: rgba(255,255,255,.45);
      --g:#45ffb1;
      --b:#78a9ff;
      --o:#ffbe6b;
      --r:#ff476b;
      --radius: 26px;
      --shadow: 0 22px 80px rgba(0,0,0,.6);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(900px 600px at 15% 12%, rgba(120,169,255,.17), transparent 55%),
        radial-gradient(900px 600px at 85% 18%, rgba(69,255,177,.12), transparent 55%),
        radial-gradient(1000px 700px at 50% 95%, rgba(255,190,107,.10), transparent 62%),
        linear-gradient(180deg, #06070b 0%, #090b10 35%, #06070b 100%);
      overflow-x:hidden;
    }
    .noise::before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='190' height='190'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='190' height='190' filter='url(%23n)' opacity='.22'/%3E%3C/svg%3E");
      opacity:.28;
      mix-blend-mode:overlay;
    }
    .wrap{
      max-width: 1100px;
      margin: 0 auto;
      padding: 28px 18px 90px;
      position: relative;
    }
    header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:16px;
      margin: 10px 0 16px;
      flex-wrap: wrap;
    }
    .brand{
      display:flex;
      gap:14px;
      align-items:flex-start;
      min-width: 260px;
    }
    .logo{
      width: 52px; height: 52px;
      border-radius: 18px;
      background:
        radial-gradient(18px 18px at 30% 30%, rgba(255,255,255,.32), transparent 60%),
        linear-gradient(135deg, rgba(69,255,177,.92), rgba(120,169,255,.90), rgba(255,190,107,.92));
      border: 1px solid rgba(255,255,255,.20);
      box-shadow: 0 0 46px rgba(120,169,255,.22), 0 0 70px rgba(69,255,177,.14);
      position: relative;
      overflow:hidden;
    }
    .logo::after{
      content:"";
      position:absolute; inset:-50%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.33), transparent);
      transform: rotate(25deg);
      animation: sweep 3.1s linear infinite;
    }
    @keyframes sweep{
      0%{ transform: translateX(-55%) rotate(25deg); opacity:0;}
      16%{ opacity:.9;}
      50%{ opacity:0;}
      100%{ transform: translateX(70%) rotate(25deg); opacity:0;}
    }
    h1{
      margin:0;
      font-size: clamp(28px, 4.7vw, 46px);
      letter-spacing:-.03em;
      line-height:1.05;
    }
    .sub{
      margin: 10px 0 0;
      color: var(--muted);
      max-width: 720px;
      line-height:1.45;
    }
    .pills{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .pill{
      display:flex;
      gap:10px;
      align-items:center;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 10px 30px rgba(0,0,0,.28);
      color: var(--muted);
      font-size: 13px;
      user-select:none;
    }
    .dot{
      width:8px; height:8px; border-radius:99px;
      background: var(--g);
      box-shadow: 0 0 18px rgba(69,255,177,.45);
    }
    .pill b{color:var(--text); font-weight:700}

    main{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 16px;
      align-items:start;
    }
    @media (max-width: 980px){ main{grid-template-columns:1fr;} }

    .card{
      background: linear-gradient(180deg, var(--panel), var(--panel2));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute; inset:0;
      pointer-events:none;
      background:
        radial-gradient(420px 240px at 20% 0%, rgba(69,255,177,.11), transparent 60%),
        radial-gradient(420px 240px at 84% 0%, rgba(120,169,255,.12), transparent 60%),
        radial-gradient(540px 300px at 50% 110%, rgba(255,190,107,.10), transparent 60%);
      opacity:.9;
    }
    .inner{ position:relative; padding:18px; }

    .row{
      display:flex; justify-content:space-between; align-items:center;
      gap:12px; flex-wrap:wrap; margin-bottom:12px;
    }
    .row h2{ margin:0; font-size:16px; letter-spacing:.02em; font-weight:800; color:rgba(255,255,255,.86); }

    .badge{
      font-family: var(--mono);
      font-size: 12px;
      padding: 7px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.28);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.78);
      display:flex; gap:8px; align-items:center;
    }

    .big{
      font-size: clamp(18px, 2.2vw, 22px);
      letter-spacing:-.02em;
      line-height:1.25;
      margin: 0 0 12px;
    }
    .muted{ color: var(--muted); }
    .muted2{ color: var(--muted2); }

    .ctrl{
      display:flex; flex-direction:column; gap:8px;
      padding: 12px;
      border-radius: 18px;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.10);
      margin-top: 10px;
    }
    label{ font-size:12px; color: var(--muted); }
    input[type="text"], textarea{
      width:100%;
      border-radius:14px;
      padding:10px 12px;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.10);
      color: rgba(255,255,255,.92);
      outline:none;
      font-family: var(--sans);
    }
    textarea{ min-height: 92px; resize: vertical; }

    .btns{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 12px; }
    button{
      appearance:none; border:0; cursor:pointer;
      border-radius:16px; padding:12px 14px;
      font-weight:900; letter-spacing:-.01em;
      color: rgba(255,255,255,.92);
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 14px 40px rgba(0,0,0,.35);
      transition: transform .15s ease, background .15s ease, border-color .15s ease;
    }
    button:hover{ transform: translateY(-1px); background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.16); }
    button:active{ transform: translateY(1px) scale(.99); }

    .primary{
      background: linear-gradient(135deg, rgba(69,255,177,.90), rgba(120,169,255,.84), rgba(255,190,107,.90));
      border-color: rgba(255,255,255,.18);
      box-shadow: 0 0 46px rgba(120,169,255,.18), 0 0 70px rgba(69,255,177,.12), 0 18px 60px rgba(0,0,0,.45);
      color: rgba(0,0,0,.82);
    }
    .danger{
      background: rgba(255,71,107,.14);
      border-color: rgba(255,71,107,.28);
    }
    .ghost{
      background: transparent;
      border: 1px dashed rgba(255,255,255,.22);
      box-shadow:none;
    }

    .divider{ height:1px; background: rgba(255,255,255,.10); margin: 14px 0; }

    .tag{
      display:inline-flex;
      gap:8px; align-items:center;
      font-family: var(--mono);
      font-size: 12px;
      padding: 7px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      color: rgba(255,255,255,.80);
    }

    .status{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .meter{
      margin-top: 10px;
      padding: 12px;
      border-radius: 18px;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.10);
    }
    .bar{
      height: 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.10);
      overflow:hidden;
      margin-top: 8px;
    }
    .fill{
      height:100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(69,255,177,.92), rgba(120,169,255,.86), rgba(255,190,107,.92));
      transition: width .25s ease;
      box-shadow: 0 0 50px rgba(69,255,177,.12);
    }

    .canvasWrap{
      margin-top: 12px;
      border-radius: 18px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      display:none;
    }
    canvas{ width:100%; height:auto; display:block; }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      padding: 12px 14px;
      border-radius: 999px;
      background: rgba(0,0,0,.62);
      border: 1px solid rgba(255,255,255,.16);
      color: rgba(255,255,255,.90);
      font-size: 13px;
      box-shadow: 0 18px 70px rgba(0,0,0,.45);
      opacity: 0;
      pointer-events:none;
      transition: opacity .2s ease, transform .2s ease;
      z-index: 50;
    }
    .toast.show{ opacity:1; transform: translateX(-50%) translateY(-6px); }

    .glitch{
      position:relative;
      display:inline-block;
    }
    .glitch::before,.glitch::after{
      content: attr(data-text);
      position:absolute; left:0; top:0;
      opacity:.55; pointer-events:none;
      clip-path: inset(0 0 0 0);
    }
    .glitch::before{ transform: translate(2px,-1px); color: rgba(255,71,107,.9); mix-blend-mode:screen; }
    .glitch::after{ transform: translate(-2px,1px); color: rgba(120,169,255,.9); mix-blend-mode:screen; }

    .foot{
      margin-top: 10px;
      font-size: 12px;
      color: rgba(255,255,255,.50);
    }
  </style>
</head>

<body class="noise">
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1 class="glitch" id="hTitle" data-text="ZOMBIE LINK">ZOMBIE LINK</h1>
          <p class="sub">
            –ú–µ–º-–≤–∏—Ä—É—Å, –∫–æ—Ç–æ—Ä—ã–π –ª—é–¥–∏ <b>—Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—é—Ç –¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ</b>.
            –ù–∏–∫–∞–∫–∏—Ö ‚Äú–≤—Ä–µ–¥–Ω—ã—Ö –≤–∏—Ä—É—Å–æ–≤‚Äù, —Ç–æ–ª—å–∫–æ <b>—É–≥–∞—Ä</b> + <b>–∫–∞—Ä—Ç–æ—á–∫–∞</b> + <b>—Å—Å—ã–ª–∫–∞ —É–∫—É—Å–∞</b>.
          </p>
        </div>
      </div>

      <div class="pills">
        <div class="pill"><span class="dot"></span><span>—Ä–µ–∂–∏–º: <b>100% local</b></span></div>
        <div class="pill"><span>—Å—Ç–∞—Ç—É—Å: <b id="statusTop">–∑–∞–≥—Ä—É–∑–∫–∞‚Ä¶</b></span></div>
      </div>
    </header>

    <main>
      <!-- LEFT -->
      <section class="card">
        <div class="inner">
          <div class="row">
            <h2>üßü –î–∏–∞–≥–Ω–æ–∑</h2>
            <div class="badge"><span>—à—Ç–∞–º–º:</span> <b id="strainCode">‚Äî</b></div>
          </div>

          <p class="big" id="diagnosisLine">‚Ä¶</p>
          <div class="status">
            <span class="tag">üß¨ —Ç–∏–ø: <b id="zType">‚Äî</b></span>
            <span class="tag">üé≠ —Å–∏–º–ø—Ç–æ–º: <b id="zSymptom">‚Äî</b></span>
            <span class="tag">üìç –∑–∞—Ä–∞–∂—ë–Ω –æ—Ç: <b id="zFrom">‚Äî</b></span>
          </div>

          <div class="meter">
            <div class="muted2" id="meterText">—É—Ä–æ–≤–µ–Ω—å –∑–∞—Ä–∞–∂–µ–Ω–∏—è: ‚Äî</div>
            <div class="bar"><div class="fill" id="fill"></div></div>
            <div class="foot" id="meterHint">–ü–æ–¥—Å–∫–∞–∑–∫–∞: —Å–≥–µ–Ω–µ—Ä—å ‚Äú—Å—Å—ã–ª–∫—É —É–∫—É—Å–∞‚Äù –∏ –∫–∏–Ω—å –¥—Ä—É–∑—å—è–º.</div>
          </div>

          <div class="ctrl">
            <label>–¢–≤–æ–π –Ω–∏–∫ (–∫–∞–∫ –ø–æ–∫–∞–∑–∞—Ç—å –¥—Ä—É–∑—å—è–º)</label>
            <input id="nick" type="text" maxlength="20" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: isak / boss / necro" />
          </div>

          <div class="btns">
            <button class="primary" id="btnBite">–°–û–ó–î–ê–¢–¨ –°–°–´–õ–ö–£ –£–ö–£–°–ê</button>
            <button id="btnCopyLink">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
            <button class="ghost" id="btnShare">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
            <button class="danger" id="btnCure">–°–±—Ä–æ—Å–∏—Ç—å –∑–∞—Ä–∞–∂–µ–Ω–∏–µ</button>
          </div>

          <div class="divider"></div>

          <div class="row">
            <h2>üì¶ –£–∫—É—Å-–∫–≤–∏—Ç–∞–Ω—Ü–∏—è</h2>
            <div class="badge"><span>–¥–ª—è —á–∞—Ç–∞/–¥—Ä—É–∑–µ–π</span></div>
          </div>

          <div class="ctrl">
            <label>–°–∫–æ–ø–∏—Ä—É–π –∏ –æ—Ç–ø—Ä–∞–≤—å —Ç–æ–º—É, –∫—Ç–æ —Ç–µ–±—è ‚Äú—É–∫—É—Å–∏–ª‚Äù (—ç—Ç–æ –¥–µ–ª–∞–µ—Ç —Ü–µ–ø–æ—á–∫—É –≤–∏—Ä—É—Å–Ω–æ–π)</label>
            <textarea id="receipt" readonly></textarea>
          </div>

          <div class="btns">
            <button id="btnCopyReceipt">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–≤–∏—Ç–∞–Ω—Ü–∏—é</button>
            <button id="btnPoster">–°–¥–µ–ª–∞—Ç—å –º–µ–º-–∫–∞—Ä—Ç–æ—á–∫—É (PNG)</button>
          </div>

          <div class="canvasWrap" id="canvasWrap">
            <canvas id="canvas" width="1200" height="630"></canvas>
          </div>

          <div class="foot">
            –í—Å—ë —Ö—Ä–∞–Ω–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (–≤ —Ç–≤–æ—ë–º –±—Ä–∞—É–∑–µ—Ä–µ). –ù–∏–∫–∞–∫–∏—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤. –ù–∏–∫–∞–∫–∏—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö. –¢–æ–ª—å–∫–æ –º–µ–º.
          </div>
        </div>
      </section>

      <!-- RIGHT -->
      <aside class="card">
        <div class="inner">
          <div class="row">
            <h2>üß† –ú—É—Ç–∞—Ü–∏—è (—Å–∞–º–æ–µ —Å–º–µ—à–Ω–æ–µ)</h2>
            <div class="badge"><span>–∂–º–∏ ‚Äî –ø–æ–ª—É—á–∞–π –Ω–æ–≤—É—é —à–∏–∑—É</span></div>
          </div>

          <p class="big">
            –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É ‚Äú–ú–£–¢–ò–†–û–í–ê–¢–¨‚Äù ‚Äî –∏ —Å–∞–π—Ç –≤—ã–¥–∞—Å—Ç —Ç–µ–±–µ –Ω–æ–≤—ã–π —Ç–∏–ø –∑–æ–º–±–∏.
            –õ—é–¥–∏ –±—É–¥—É—Ç <b>—à–µ—Ä–∏—Ç—å —Ä–∞–¥–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è</b> (‚Äú–∫–∞–∫–æ–π —Ç—ã –∑–æ–º–±–∏?‚Äù).
          </p>

          <div class="btns">
            <button class="primary" id="btnMutate">–ú–£–¢–ò–†–û–í–ê–¢–¨</button>
            <button class="ghost" id="btnSpeak">–û–∑–≤—É—á–∏—Ç—å –¥–∏–∞–≥–Ω–æ–∑</button>
          </div>

          <div class="divider"></div>

          <div class="ctrl">
            <label>–ú–∏–Ω–∏-–ø—Ä–∞–≤–∏–ª–æ –≤–∏—Ä—É—Å–∞ (–ø—Ä–æ—Å—Ç–æ–µ):</label>
            <textarea readonly>
1) –°–¥–µ–ª–∞–π —Å—Å—ã–ª–∫—É —É–∫—É—Å–∞.
2) –ö–∏–Ω—å 3 –ª—é–¥—è–º.
3) –ö–∞–∂–¥—ã–π –∑–∞—Ä–∞–∂—ë–Ω–Ω—ã–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–±–µ ‚Äú–∫–≤–∏—Ç–∞–Ω—Ü–∏—é‚Äù.
4) –¢—ã –≤—ã–∫–ª–∞–¥—ã–≤–∞–µ—à—å –º–µ–º-–∫–∞—Ä—Ç–æ—á–∫—É –≤ —Å—Ç–æ—Ä–∏—Å/—á–∞—Ç.
–¶–µ–ø–æ—á–∫–∞ –ø–æ—à–ª–∞.</textarea>
          </div>

          <div class="divider"></div>

          <p class="muted">
            ‚ö° –•–∞–∫ –≤–∏—Ä—É—Å–Ω–æ—Å—Ç–∏: –¥–æ–±–∞–≤—å –≤ –∫–æ–Ω–µ—Ü –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏ —Ñ—Ä–∞–∑—É ‚Äú–ø—Ä–æ–≤–µ—Ä—å —Å–µ–±—è —Ç—É—Ç‚Äù + —Å—Å—ã–ª–∫—É.
            –õ—é–¥–∏ –ø–µ—Ä–µ—Å—ã–ª–∞—é—Ç –¥–∞–ª—å—à–µ –±–µ–∑ –ø—Ä–∏–Ω—É–∂–¥–µ–Ω–∏—è, –ø–æ—Ç–æ–º—É —á—Ç–æ –∏–º —Å–º–µ—à–Ω–æ.
          </p>
        </div>
      </aside>
    </main>
  </div>

  <div class="toast" id="toast">ok</div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);
  const KEY = "zombie_link_v1";

  const Z_TYPES = [
    "Wi-Fi –ì—É–ª—å",
    "–ö—Ä–∏–ø—Ç–æ-–ù–µ–∫—Ä–æ–º–∞–Ω—Ç",
    "–°—Ç—É–¥–µ–Ω—Ç-–ü–æ–∂–∏—Ä–∞—Ç–µ–ª—å –î–µ–¥–ª–∞–π–Ω–æ–≤",
    "–ó–æ–º–±–∏-–ü–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏—Å—Ç (–æ–ø–∞—Å–Ω–µ–π—à–∏–π)",
    "–ú–µ–º-–ü–∞—Ä–∞–∑–∏—Ç",
    "–ù–æ—á–Ω–æ–π –ö–æ–º–º–∏—Ç–µ—Ä",
    "–¢–∏–∫–¢–æ–∫-–í–∞–º–ø–∏—Ä –≤–Ω–∏–º–∞–Ω–∏—è",
    "–ö–æ—Ñ–µ-–õ–∏—á",
    "–î—É–º—Å–∫—Ä–æ–ª–ª-–ú—É—Ç–∞–Ω—Ç",
    "–®–æ—Ä—Ç—Å-–ö–∞—Ä–∞—Ç–µ–ª—å"
  ];

  const Z_SYMPTOMS = [
    "–≥–æ–≤–æ—Ä–∏—Ç ‚Äú—â–∞—Å –Ω–∞—á–Ω—É‚Äù –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞",
    "–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç 14 –≤–∫–ª–∞–¥–æ–∫ –∏ —É–º–∏—Ä–∞–µ—Ç",
    "–ø–∏—Ç–∞–µ—Ç—Å—è –¥–µ–¥–ª–∞–π–Ω–∞–º–∏ –∏ —Å–æ–∂–∞–ª–µ–Ω–∏–µ–º",
    "–Ω–µ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –∏ ‚Äú–µ—â—ë 5 –º–∏–Ω—É—Ç‚Äù",
    "—Å—á–∏—Ç–∞–µ—Ç, —á—Ç–æ –∑–∞–≤—Ç—Ä–∞ —Å—Ç–∞–Ω–µ—Ç –¥—Ä—É–≥–∏–º —á–µ–ª–æ–≤–µ–∫–æ–º",
    "–ø–∏—à–µ—Ç –ø–ª–∞–Ω—ã –≤–º–µ—Å—Ç–æ –¥–µ–π—Å—Ç–≤–∏–π",
    "—á–∏—Ç–∞–µ—Ç –º–æ—Ç–∏–≤–∞—Ü–∏—é –≤–º–µ—Å—Ç–æ —Ä–∞–±–æ—Ç—ã",
    "–∂–º—ë—Ç ‚Äú–µ—â—ë –æ–¥–∏–Ω —Ä–æ–ª–∏–∫‚Äù –¥–æ —É—Ç—Ä–∞",
    "–ø—Ä–æ—Å–∏—Ç –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ –∫–∞–∫ –∑–∞—Ä–ø–ª–∞—Ç—É",
    "–¥–µ–ª–∞–µ—Ç –≤—Å—ë –∏–¥–µ–∞–ª—å–Ω–æ, –Ω–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–∫–ª–∞–¥—ã–≤–∞–µ—Ç"
  ];

  const ROASTS = [
    "–¢—ã –∑–∞—Ä–∞–∂—ë–Ω. –ü–æ–∑–¥—Ä–∞–≤–ª—è—é. –¢–µ–ø–µ—Ä—å —Ç—ã —Ö–æ—Ç—è –±—ã –∂–∏–≤—ë—à—å.",
    "–î–∏–∞–≥–Ω–æ–∑: —Ç—ã –Ω–µ –ª–µ–Ω–∏–≤—ã–π. –¢—ã –ø—Ä–æ—Å—Ç–æ –≤ —Ä–µ–∂–∏–º–µ NPC.",
    "–£ —Ç–µ–±—è —Ä–µ–¥–∫–∏–π —à—Ç–∞–º–º: ‚Äú—è —â–∞—Å –Ω–∞—á–Ω—É‚Äù. –õ–µ—á–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–µ–ª–æ–º.",
    "–°–∏–º–ø—Ç–æ–º—ã –æ–ø–∞—Å–Ω—ã–µ. –ù–æ —Å–º–µ—à–Ω—ã–µ. –ü–æ—ç—Ç–æ–º—É —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—é—Ç—Å—è.",
    "–≠—Ç–æ –Ω–µ –±–æ–ª–µ–∑–Ω—å. –≠—Ç–æ —Å—Ç–∏–ª—å –∂–∏–∑–Ω–∏. –ü—É–≥–∞—é—â–∏–π, –Ω–æ —Å—Ç–∏–ª—å."
  ];

  const toast = (msg) => {
    const t = $("toast");
    t.textContent = msg;
    t.classList.add("show");
    setTimeout(() => t.classList.remove("show"), 1500);
  };

  const rand = (arr) => arr[Math.floor(Math.random()*arr.length)];
  const makeCode = () => Math.random().toString(36).slice(2, 6).toUpperCase();
  const sanitizeNick = (s) => String(s || "").trim().slice(0,20).replace(/[^\p{L}\p{N}_\-\. ]/gu, "");

  const state = {
    code: null,
    type: null,
    symptom: null,
    from: null,
    nick: "",
    infectedLevel: 0,
    createdAt: null
  };

  function load(){
    try{
      const raw = localStorage.getItem(KEY);
      if(raw){
        Object.assign(state, JSON.parse(raw));
      }
    }catch(e){}
  }
  function save(){
    localStorage.setItem(KEY, JSON.stringify(state));
  }

  function parseIncoming(){
    const p = new URLSearchParams(location.search);
    const from = sanitizeNick(p.get("from"));
    const strain = (p.get("s") || "").slice(0,8).toUpperCase();

    // –ï—Å–ª–∏ –ø—Ä–∏—à–ª–∏ –ø–æ ‚Äú—É–∫—É—Å—É‚Äù ‚Äî –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º, –æ—Ç –∫–æ–≥–æ –∑–∞—Ä–∞–∑–∏–ª–∏—Å—å
    if(from){
      state.from = from;
      state.infectedLevel = Math.min(100, Math.max(state.infectedLevel || 0, 72));
    }
    // –ï—Å–ª–∏ —à—Ç–∞–º–º –µ—Å—Ç—å ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ —á–∞—Å—Ç—å –æ—â—É—â–µ–Ω–∏—è ‚Äú—Ü–µ–ø–æ—á–∫–∏‚Äù
    if(strain && !state.code){
      state.code = strain;
    }
  }

  function ensureBase(){
    if(!state.code) state.code = makeCode();
    if(!state.type) state.type = rand(Z_TYPES);
    if(!state.symptom) state.symptom = rand(Z_SYMPTOMS);
    if(!state.createdAt) state.createdAt = Date.now();
    if(state.infectedLevel == null) state.infectedLevel = 64;
  }

  function render(){
    $("strainCode").textContent = state.code;
    $("zType").textContent = state.type;
    $("zSymptom").textContent = state.symptom;
    $("zFrom").textContent = state.from ? ("@" + state.from) : "—Å–∞–º–æ–∑–∞—Ä–∞–∂–µ–Ω–∏–µ";

    $("nick").value = state.nick || "";

    const diagnosis = `${rand(ROASTS)}\n\n–¢–≤–æ–π —Ç–∏–ø: ${state.type}. –°–∏–º–ø—Ç–æ–º: ${state.symptom}.`;
    $("diagnosisLine").textContent = diagnosis;

    $("statusTop").textContent = state.from ? `–∑–∞—Ä–∞–∂—ë–Ω –æ—Ç @${state.from}` : "–∑–∞—Ä–∞–∂—ë–Ω (—Å–∞–º)";

    const lvl = Math.max(0, Math.min(100, state.infectedLevel));
    $("fill").style.width = lvl + "%";
    $("meterText").textContent = `—É—Ä–æ–≤–µ–Ω—å –∑–∞—Ä–∞–∂–µ–Ω–∏—è: ${lvl}%`;
    $("meterHint").textContent =
      lvl >= 90 ? "–¢—ã —É–∂–µ –ø–æ—á—Ç–∏ –ª–µ–≥–µ–Ω–¥–∞. –î–µ–ª–∏—Å—å –∫–∞—Ä—Ç–æ—á–∫–æ–π."
      : lvl >= 70 ? "–ù–æ—Ä–º. –¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–π —Å—Å—ã–ª–∫—É —É–∫—É—Å–∞ –∏ –∫–∏–Ω—å –¥—Ä—É–∑—å—è–º."
      : "–°–ª–∞–±–∞—è –∏–Ω—Ñ–µ–∫—Ü–∏—è. –ú—É—Ç–∏—Ä—É–π ‚Äî –∏ –∑–∞–∫—Ä–µ–ø–∏ –¥–∏–∞–≥–Ω–æ–∑ –≤ —á–∞—Ç–µ.";

    $("receipt").value = buildReceiptText();
  }

  function buildBiteLink(){
    const nick = sanitizeNick(state.nick || "anonymous");
    const u = new URL(location.href);
    u.searchParams.set("from", nick);
    u.searchParams.set("s", state.code);
    return u.toString();
  }

  function buildReceiptText(){
    const me = sanitizeNick(state.nick || "anonymous");
    const from = state.from ? ("@" + state.from) : "(–Ω–∏–∫—Ç–æ)";
    const link = buildBiteLink();

    return `üßü ZOMBIE LINK ‚Äî –£–ö–£–°-–ö–í–ò–¢–ê–ù–¶–ò–Ø

–Ø –∑–∞—Ä–∞–∂—ë–Ω.
–û—Ç –∫–æ–≥–æ: ${from}
–ú–æ–π —à—Ç–∞–º–º: ${state.code}
–ú–æ–π —Ç–∏–ø: ${state.type}
–°–∏–º–ø—Ç–æ–º: ${state.symptom}

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–±—è –∏ –∑–∞—Ä–∞–∑–∏—Ç—å –¥–∞–ª—å—à–µ:
${link}

(–¥–∞, —ç—Ç–æ –º–µ–º. –Ω–æ –æ–Ω —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è.)`;
  }

  function copy(text){
    navigator.clipboard.writeText(text).then(() => toast("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ.")).catch(() => toast("–ù–µ —Å–º–æ–≥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å."));
  }

  function mutate(){
    state.type = rand(Z_TYPES);
    state.symptom = rand(Z_SYMPTOMS);
    state.infectedLevel = Math.min(100, (state.infectedLevel || 60) + 7);
    save();
    render();
    toast("–ú—É—Ç–∞—Ü–∏—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∞.");
  }

  function speak(){
    try{
      const txt = `–í–Ω–∏–º–∞–Ω–∏–µ. –î–∏–∞–≥–Ω–æ–∑: –∑–∞—Ä–∞–∂–µ–Ω–∏–µ. –¢–∏–ø: ${state.type}. –°–∏–º–ø—Ç–æ–º: ${state.symptom}.`;
      const u = new SpeechSynthesisUtterance(txt);
      u.lang = "ru-RU";
      u.rate = 1.02;
      speechSynthesis.cancel();
      speechSynthesis.speak(u);
    }catch(e){
      toast("–û–∑–≤—É—á–∫–∞ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.");
    }
  }

  function createBite(){
    const nick = sanitizeNick($("nick").value);
    state.nick = nick || "anonymous";
    state.infectedLevel = Math.min(100, Math.max(state.infectedLevel || 60, 82));
    save();
    render();
    const link = buildBiteLink();
    copy(link);
    toast("–°—Å—ã–ª–∫–∞ —É–∫—É—Å–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞. –ö–∏–¥–∞–π –≤ —á–∞—Ç.");
  }

  function reset(){
    localStorage.removeItem(KEY);
    Object.keys(state).forEach(k => state[k] = null);
    state.nick = "";
    state.infectedLevel = 0;
    state.createdAt = null;
    history.replaceState({}, "", location.origin + location.pathname);
    load();
    ensureBase();
    save();
    render();
    toast("–ó–∞—Ä–∞–∂–µ–Ω–∏–µ —Å–±—Ä–æ—à–µ–Ω–æ.");
  }

  // Poster (PNG)
  function poster(){
    const c = $("canvas");
    const ctx = c.getContext("2d");
    const w = c.width, h = c.height;

    // bg
    ctx.fillStyle = "#090b10";
    ctx.fillRect(0,0,w,h);

    const g1 = ctx.createRadialGradient(w*0.2, h*0.15, 40, w*0.2, h*0.15, w*0.9);
    g1.addColorStop(0, "rgba(120,169,255,0.18)");
    g1.addColorStop(1, "rgba(0,0,0,0)");
    ctx.fillStyle = g1; ctx.fillRect(0,0,w,h);

    const g2 = ctx.createRadialGradient(w*0.85, h*0.18, 40, w*0.85, h*0.18, w*0.9);
    g2.addColorStop(0, "rgba(69,255,177,0.14)");
    g2.addColorStop(1, "rgba(0,0,0,0)");
    ctx.fillStyle = g2; ctx.fillRect(0,0,w,h);

    // card
    const pad = 56;
    roundRect(ctx, pad, pad, w-pad*2, h-pad*2, 34, "rgba(255,255,255,0.06)", "rgba(255,255,255,0.11)");

    // header
    ctx.fillStyle = "rgba(255,255,255,0.90)";
    ctx.font = "900 46px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
    ctx.fillText("ZOMBIE LINK", pad+34, pad+80);

    ctx.fillStyle = "rgba(255,255,255,0.70)";
    ctx.font = "700 18px ui-monospace, Menlo, Monaco, Consolas, monospace";
    ctx.fillText(`STRAIN: ${state.code}   INFECTED BY: ${state.from ? "@"+state.from : "SELF"}`, pad+34, pad+110);

    // main
    ctx.fillStyle = "rgba(255,255,255,0.92)";
    ctx.font = "900 40px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
    wrapText(ctx, `–¢–´ –ó–ê–†–ê–ñ–Å–ù.\n${state.type}`, pad+34, pad+180, w-pad*2-68, 46, 3);

    ctx.fillStyle = "rgba(255,255,255,0.70)";
    ctx.font = "800 22px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial";
    wrapText(ctx, `–°–∏–º–ø—Ç–æ–º: ${state.symptom}`, pad+34, pad+320, w-pad*2-68, 32, 3);

    // link
    const link = buildBiteLink();
    ctx.fillStyle = "rgba(255,255,255,0.65)";
    ctx.font = "700 16px ui-monospace, Menlo, Monaco, Consolas, monospace";
    wrapText(ctx, `–ó–∞—Ä–∞–∑–∏—Ç—å –¥–∞–ª—å—à–µ: ${link}`, pad+34, h-pad-70, w-pad*2-68, 22, 2);

    // show canvas
    $("canvasWrap").style.display = "block";

    // download
    const a = document.createElement("a");
    a.download = `zombie-link_${state.code}.png`;
    a.href = c.toDataURL("image/png");
    a.click();
    toast("PNG —Å–∫–∞—á–∞–Ω. –ö–∏–¥–∞–π –¥—Ä—É–∑—å—è–º.");
  }

  function roundRect(ctx, x, y, w, h, r, fill, stroke){
    ctx.beginPath();
    ctx.moveTo(x+r, y);
    ctx.arcTo(x+w, y, x+w, y+h, r);
    ctx.arcTo(x+w, y+h, x, y+h, r);
    ctx.arcTo(x, y+h, x, y, r);
    ctx.arcTo(x, y, x+w, y, r);
    ctx.closePath();
    if(fill){ ctx.fillStyle = fill; ctx.fill(); }
    if(stroke){ ctx.strokeStyle = stroke; ctx.lineWidth = 2; ctx.stroke(); }
  }
  function wrapText(ctx, text, x, y, maxWidth, lineHeight, maxLines=3){
    const parts = String(text).split("\n");
    let yy = y;
    for(const block of parts){
      const words = block.split(" ");
      let line = "";
      for(let n=0; n<words.length; n++){
        const testLine = line + words[n] + " ";
        if(ctx.measureText(testLine).width > maxWidth && n>0){
          ctx.fillText(line, x, yy);
          line = words[n] + " ";
          yy += lineHeight;
          maxLines--;
          if(maxLines <= 0){ ctx.fillText("‚Ä¶", x, yy); return; }
        } else {
          line = testLine;
        }
      }
      if(line){
        ctx.fillText(line, x, yy);
        yy += lineHeight;
        maxLines--;
        if(maxLines <= 0) return;
      }
    }
  }

  // Share
  async function shareLink(){
    const link = buildBiteLink();
    if(navigator.share){
      try{
        await navigator.share({ title:"ZOMBIE LINK", text:"–¢—ã –∑–∞—Ä–∞–∂—ë–Ω. –ü—Ä–æ–≤–µ—Ä—å —Å–µ–±—è.", url: link });
        toast("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ.");
      }catch(e){
        copy(link);
      }
    } else {
      copy(link);
    }
  }

  // Wire UI
  $("btnMutate").addEventListener("click", mutate);
  $("btnSpeak").addEventListener("click", speak);

  $("nick").addEventListener("input", () => {
    state.nick = sanitizeNick($("nick").value);
    save();
    $("receipt").value = buildReceiptText();
  });

  $("btnBite").addEventListener("click", createBite);
  $("btnCopyLink").addEventListener("click", () => copy(buildBiteLink()));
  $("btnShare").addEventListener("click", shareLink);
  $("btnCopyReceipt").addEventListener("click", () => copy($("receipt").value));
  $("btnPoster").addEventListener("click", poster);
  $("btnCure").addEventListener("click", reset);

  // Init
  load();
  parseIncoming();
  ensureBase();

  // –µ—Å–ª–∏ –∑–∞—à—ë–ª –ø–æ —É–∫—É—Å—É ‚Äî —á—É—Ç—å ‚Äú—ç—Ñ—Ñ–µ–∫—Ç‚Äù
  if(state.from){
    state.infectedLevel = Math.min(100, Math.max(state.infectedLevel||0, 78));
  } else if(!state.infectedLevel || state.infectedLevel < 55){
    state.infectedLevel = 58;
  }

  save();
  render();
})();
</script>
</body>
</html>
